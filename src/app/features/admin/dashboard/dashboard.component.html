<div class="max-w-7xl mx-auto px-4 py-6">
  <!-- Header with Month Selector -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6">
    <h1 class="text-3xl font-bold text-gray-800 mb-4 md:mb-0">Dashboard Administrativo</h1>
    <app-month-picker
      [selectedMonth]="selectedMonth"
      (monthChange)="onMonthChange($event)">
    </app-month-picker>
  </div>

  <!-- Error Message -->
  @if (error) {
    <div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6">
      {{ error }}
    </div>
  }

  <!-- KPI Cards Grid -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
    <app-kpi-card
      title="Ingresos"
      [value]="kpis?.totalIncome || 0"
      format="currency"
      icon="üí∞"
      color="green"
      [loading]="loading">
    </app-kpi-card>

    <app-kpi-card
      title="Gastos"
      [value]="kpis?.totalExpenses || 0"
      format="currency"
      icon="üí∏"
      color="red"
      [loading]="loading">
    </app-kpi-card>

    <app-kpi-card
      title="Ganancia Neta"
      [value]="kpis?.netProfit || 0"
      format="currency"
      icon="üìà"
      color="blue"
      [loading]="loading">
    </app-kpi-card>

    <app-kpi-card
      title="Margen"
      [value]="kpis?.profitMarginPercentage || 0"
      format="percentage"
      icon="üìä"
      color="purple"
      [loading]="loading">
    </app-kpi-card>

    <app-kpi-card
      title="Viajes Completados"
      [value]="kpis?.completedTrips || 0"
      format="number"
      icon="‚úÖ"
      color="yellow"
      [loading]="loading">
    </app-kpi-card>
  </div>

  <!-- Secondary KPIs Grid -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
    <app-kpi-card
      title="Viajes En Curso"
      [value]="kpis?.tripsInProgress || 0"
      format="number"
      icon="üöõ"
      color="blue"
      [loading]="loading">
    </app-kpi-card>

    <app-kpi-card
      title="Clientes Activos"
      [value]="kpis?.activeCustomers || 0"
      format="number"
      icon="üë•"
      color="purple"
      [loading]="loading">
    </app-kpi-card>

    <app-kpi-card
      title="Veh√≠culos Disponibles"
      [value]="kpis?.activeVehicles || 0"
      format="number"
      icon="üöó"
      color="green"
      [loading]="loading">
    </app-kpi-card>

    <app-kpi-card
      title="IVA a Pagar"
      [value]="kpis?.ivaBalance || 0"
      format="currency"
      icon="üßæ"
      color="yellow"
      [loading]="loading">
    </app-kpi-card>
  </div>

  <!-- Chart Section -->
  <div class="bg-white rounded-lg shadow p-6 mb-8">
    <h2 class="text-xl font-semibold text-gray-800 mb-4">Tendencias (√öltimos 6 Meses)</h2>
    @if (trends && chartLabels.length > 0) {
      <app-line-chart
        [labels]="chartLabels"
        [datasets]="chartDatasets"
        height="400px">
      </app-line-chart>
    } @else {
      <div class="flex items-center justify-center h-64">
        <p class="text-gray-500">Cargando gr√°fico...</p>
      </div>
    }
  </div>

  <!-- Additional Stats -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Trip Stats -->
    <div class="bg-white rounded-lg shadow p-6">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">Estad√≠sticas de Viajes</h3>
      @if (kpis && !loading) {
        <div class="space-y-3">
          <div class="flex justify-between items-center">
            <span class="text-gray-600">Kil√≥metros Totales:</span>
            <span class="font-semibold">{{ kpis.totalKilometers | number: '1.0-0':'es-CL' }} km</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-gray-600">Rentabilidad Promedio:</span>
            <span class="font-semibold text-green-600">{{ kpis.avgTripProfitability }}%</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-gray-600">Viajes Pendientes:</span>
            <span class="font-semibold">{{ kpis.pendingTrips }}</span>
          </div>
        </div>
      } @else {
        <div class="animate-pulse space-y-3">
          <div class="h-4 bg-gray-200 rounded w-full"></div>
          <div class="h-4 bg-gray-200 rounded w-3/4"></div>
          <div class="h-4 bg-gray-200 rounded w-5/6"></div>
        </div>
      }
    </div>

    <!-- Invoice Stats -->
    <div class="bg-white rounded-lg shadow p-6">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">Facturaci√≥n</h3>
      @if (kpis && !loading) {
        <div class="space-y-3">
          <div class="flex justify-between items-center">
            <span class="text-gray-600">Facturas Emitidas:</span>
            <span class="font-semibold text-green-600">{{ kpis.issuedSaleInvoices }}</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-gray-600">Facturas Pendientes:</span>
            <span class="font-semibold text-yellow-600">{{ kpis.pendingSaleInvoices }}</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-gray-600">Conductores Activos:</span>
            <span class="font-semibold">{{ kpis.activeDrivers }}</span>
          </div>
        </div>
      } @else {
        <div class="animate-pulse space-y-3">
          <div class="h-4 bg-gray-200 rounded w-full"></div>
          <div class="h-4 bg-gray-200 rounded w-3/4"></div>
          <div class="h-4 bg-gray-200 rounded w-5/6"></div>
        </div>
      }
    </div>
  </div>
</div>
