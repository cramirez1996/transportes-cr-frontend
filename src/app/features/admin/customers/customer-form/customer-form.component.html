<form [formGroup]="customerForm" (ngSubmit)="onSubmit()" class="space-y-4">
  <!-- API Error Alert -->
  <div *ngIf="apiError" class="p-4 bg-red-50 border border-red-200 rounded-md flex items-start gap-3">
    <svg class="w-5 h-5 text-red-600 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
    </svg>
    <div class="flex-1">
      <h3 class="text-sm font-medium text-red-800">Error al guardar</h3>
      <p class="text-sm text-red-700 mt-1">{{ apiError }}</p>
    </div>
    <button type="button" (click)="apiError = null" class="text-red-400 hover:text-red-600">
      <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
      </svg>
    </button>
  </div>

  <div class="grid grid-cols-2 gap-4">
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">RUT *</label>
      <input
        type="text"
        formControlName="rut"
        appRutFormat
        placeholder="12345678-9"
        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
        [class.border-red-500]="customerForm.get('rut')?.invalid && customerForm.get('rut')?.touched"
      />
      <p class="text-red-500 text-xs mt-1">{{ getErrorMessage('rut') }}</p>
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Razón Social *</label>
      <input
        type="text"
        formControlName="businessName"
        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
        [class.border-red-500]="customerForm.get('businessName')?.invalid && customerForm.get('businessName')?.touched"
      />
      <p class="text-red-500 text-xs mt-1">{{ getErrorMessage('businessName') }}</p>
    </div>
  </div>

  <div class="grid grid-cols-2 gap-4">
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Nombre de Contacto *</label>
      <input
        type="text"
        formControlName="contactName"
        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
        [class.border-red-500]="customerForm.get('contactName')?.invalid && customerForm.get('contactName')?.touched"
      />
      <p class="text-red-500 text-xs mt-1">{{ getErrorMessage('contactName') }}</p>
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
      <input
        type="email"
        formControlName="email"
        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
        [class.border-red-500]="customerForm.get('email')?.invalid && customerForm.get('email')?.touched"
      />
      <p class="text-red-500 text-xs mt-1">{{ getErrorMessage('email') }}</p>
    </div>
  </div>

  <div class="grid grid-cols-2 gap-4">
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Teléfono *</label>
      <input
        type="text"
        formControlName="phone"
        placeholder="+56 9 1234 5678"
        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
        [class.border-red-500]="customerForm.get('phone')?.invalid && customerForm.get('phone')?.touched"
      />
      <p class="text-red-500 text-xs mt-1">{{ getErrorMessage('phone') }}</p>
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Estado *</label>
      <select
        formControlName="status"
        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
      >
        <option value="ACTIVE">Activo</option>
        <option value="INACTIVE">Inactivo</option>
      </select>
    </div>
  </div>

  <div>
    <label class="block text-sm font-medium text-gray-700 mb-1">Dirección *</label>
    <input
      type="text"
      formControlName="address"
      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
      [class.border-red-500]="customerForm.get('address')?.invalid && customerForm.get('address')?.touched"
    />
    <p class="text-red-500 text-xs mt-1">{{ getErrorMessage('address') }}</p>
  </div>

  <div class="grid grid-cols-2 gap-4">
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Ciudad *</label>
      <input
        type="text"
        formControlName="city"
        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
        [class.border-red-500]="customerForm.get('city')?.invalid && customerForm.get('city')?.touched"
      />
      <p class="text-red-500 text-xs mt-1">{{ getErrorMessage('city') }}</p>
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Región *</label>
      <select
        formControlName="region"
        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
        [class.border-red-500]="customerForm.get('region')?.invalid && customerForm.get('region')?.touched"
      >
        <option value="">Seleccionar región</option>
        <option value="Metropolitana">Metropolitana</option>
        <option value="Valparaíso">Valparaíso</option>
        <option value="Biobío">Biobío</option>
        <option value="Araucanía">Araucanía</option>
        <option value="Los Lagos">Los Lagos</option>
        <option value="Maule">Maule</option>
        <option value="O'Higgins">O'Higgins</option>
        <option value="Coquimbo">Coquimbo</option>
        <option value="Antofagasta">Antofagasta</option>
        <option value="Atacama">Atacama</option>
        <option value="Tarapacá">Tarapacá</option>
        <option value="Arica y Parinacota">Arica y Parinacota</option>
        <option value="Los Ríos">Los Ríos</option>
        <option value="Aysén">Aysén</option>
        <option value="Magallanes">Magallanes</option>
        <option value="Ñuble">Ñuble</option>
      </select>
      <p class="text-red-500 text-xs mt-1">{{ getErrorMessage('region') }}</p>
    </div>
  </div>

  <!-- Tags Editor -->
  <div class="mt-4 p-4 bg-gray-50 rounded-md border border-gray-200">
    <app-tags-editor
      [tags]="customerForm.get('tags')?.value"
      (tagsChange)="onTagsChange($event)"
      placeholder="Tags personalizados del cliente"
    ></app-tags-editor>
  </div>

  <div class="flex justify-end gap-3 pt-4">
    <button
      type="button"
      (click)="onCancel()"
      [disabled]="isSubmitting"
      class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
    >
      Cancelar
    </button>
    <button
      type="submit"
      [disabled]="customerForm.invalid || isSubmitting"
      class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2"
    >
      <!-- Loading Spinner -->
      <svg *ngIf="isSubmitting" class="animate-spin h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
      <span>
        <ng-container *ngIf="isSubmitting">
          {{ customer ? 'Actualizando...' : 'Creando...' }}
        </ng-container>
        <ng-container *ngIf="!isSubmitting">
          {{ customer ? 'Actualizar' : 'Crear' }} Cliente
        </ng-container>
      </span>
    </button>
  </div>
</form>
