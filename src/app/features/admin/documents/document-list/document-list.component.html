<div class="container mx-auto px-4 py-6">
  <!-- Header -->
  <div class="mb-6 flex justify-between items-center">
    <div>
      <h1 class="text-2xl font-bold text-gray-900">Gestión de Documentos</h1>
      <p class="text-sm text-gray-600 mt-1">Administra todos los documentos del sistema</p>
    </div>
    <button
      (click)="openUploadModal()"
      class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
      </svg>
      Subir Documento
    </button>
  </div>

  <!-- Filtros -->
  <div class="mb-6 bg-white p-4 rounded-lg shadow space-y-4">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <!-- Filtro por tipo de entidad -->
      <div>
        <label for="entityTypeFilter" class="block text-sm font-medium text-gray-700 mb-2">
          Tipo de Entidad:
        </label>
        <select
          id="entityTypeFilter"
          [(ngModel)]="selectedEntityType"
          (change)="onFilterChange()"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
          <option value="all">Todas las entidades</option>
          <option *ngFor="let type of DocumentEntityType | keyvalue" [value]="type.value">
            {{ documentEntityTypeLabels[type.value] }}
          </option>
        </select>
      </div>

      <!-- Filtro por tipo de documento -->
      <div>
        <label for="documentTypeFilter" class="block text-sm font-medium text-gray-700 mb-2">
          Tipo de Documento:
        </label>
        <select
          id="documentTypeFilter"
          [(ngModel)]="selectedDocumentType"
          (change)="onFilterChange()"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
          <option value="all">Todos los tipos</option>
          <option *ngFor="let type of DocumentType | keyvalue" [value]="type.value">
            {{ documentTypeLabels[type.value] }}
          </option>
        </select>
      </div>

      <!-- Búsqueda de texto -->
      <div>
        <label for="searchInput" class="block text-sm font-medium text-gray-700 mb-2">
          Buscar:
        </label>
        <input
          id="searchInput"
          type="text"
          [(ngModel)]="searchTerm"
          (input)="onFilterChange()"
          placeholder="Nombre, descripción..."
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
      </div>
    </div>

    <!-- Filtros adicionales (checkboxes) -->
    <div class="flex flex-wrap gap-4">
      <label class="flex items-center gap-2 cursor-pointer">
        <input
          type="checkbox"
          [(ngModel)]="showOnlyExpiring"
          (change)="onFilterChange()"
          class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
        <span class="text-sm text-gray-700">Solo próximos a vencer</span>
      </label>

      <label class="flex items-center gap-2 cursor-pointer">
        <input
          type="checkbox"
          [(ngModel)]="showOnlyExpired"
          (change)="onFilterChange()"
          class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
        <span class="text-sm text-gray-700">Solo vencidos</span>
      </label>

      <label class="flex items-center gap-2 cursor-pointer">
        <input
          type="checkbox"
          [(ngModel)]="showOnlyUnverified"
          (change)="onFilterChange()"
          class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
        <span class="text-sm text-gray-700">Solo no verificados</span>
      </label>
    </div>
  </div>

  <!-- Tabla de documentos -->
  <div class="bg-white shadow-md rounded-lg overflow-hidden">
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Documento
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Tipo
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Entidad
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Tamaño
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Fecha de Emisión
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Vencimiento
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Estado
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Acciones
            </th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <tr *ngIf="loading">
            <td colspan="8" class="px-6 py-8 text-center text-gray-500">
              Cargando documentos...
            </td>
          </tr>
          <tr *ngIf="!loading && filteredDocuments.length === 0">
            <td colspan="8" class="px-6 py-8 text-center text-gray-500">
              No se encontraron documentos
            </td>
          </tr>
          <tr *ngFor="let document of filteredDocuments" class="hover:bg-gray-50">
            <!-- Documento -->
            <td class="px-6 py-4">
              <div class="flex items-center gap-3">
                <div class="flex-shrink-0">
                  <svg class="w-8 h-8 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd"/>
                  </svg>
                </div>
                <div>
                  <div class="text-sm font-medium text-gray-900">{{ document.originalName }}</div>
                  <div *ngIf="document.description" class="text-xs text-gray-500">{{ document.description }}</div>
                </div>
              </div>
            </td>

            <!-- Tipo -->
            <td class="px-6 py-4 whitespace-nowrap">
              <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">
                {{ documentTypeLabels[document.documentType] }}
              </span>
            </td>

            <!-- Entidad -->
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
              {{ documentEntityTypeLabels[document.entityType] }}
            </td>

            <!-- Tamaño -->
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
              {{ formatFileSize(document.fileSize) }}
            </td>

            <!-- Fecha de Emisión -->
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
              {{ formatDate(document.issueDate) }}
            </td>

            <!-- Vencimiento -->
            <td class="px-6 py-4 whitespace-nowrap">
              <div *ngIf="document.expiryDate" class="text-sm">
                <div>{{ formatDate(document.expiryDate) }}</div>
                <span [class]="'px-2 mt-1 inline-flex text-xs leading-5 font-semibold rounded-full ' + getExpiryBadgeClass(document)">
                  {{ getExpiryLabel(document) }}
                </span>
              </div>
              <span *ngIf="!document.expiryDate" class="text-sm text-gray-500">-</span>
            </td>

            <!-- Estado de verificación -->
            <td class="px-6 py-4 whitespace-nowrap">
              <span *ngIf="document.isVerified" class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                Verificado
              </span>
              <span *ngIf="!document.isVerified" class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                Sin verificar
              </span>
            </td>

            <!-- Acciones -->
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
              <div class="flex gap-2">
                <!-- Ver detalle -->
                <a
                  [routerLink]="['/admin/documents', document.id]"
                  class="text-gray-600 hover:text-gray-900"
                  title="Ver detalle">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                  </svg>
                </a>

                <!-- Descargar -->
                <button
                  (click)="downloadDocument(document)"
                  class="text-blue-600 hover:text-blue-900"
                  title="Descargar">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                  </svg>
                </button>

                <!-- Verificar/Desverificar -->
                <button
                  (click)="verifyDocument(document)"
                  [class]="document.isVerified ? 'text-orange-600 hover:text-orange-900' : 'text-green-600 hover:text-green-900'"
                  [title]="document.isVerified ? 'Desverificar' : 'Verificar'">
                  <svg *ngIf="!document.isVerified" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                  <svg *ngIf="document.isVerified" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                </button>

                <!-- Eliminar -->
                <button
                  (click)="deleteDocument(document)"
                  class="text-red-600 hover:text-red-900"
                  title="Eliminar">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                  </svg>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Estadísticas -->
  <div class="mt-6 grid grid-cols-1 md:grid-cols-5 gap-4">
    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
      <div class="text-blue-800 text-sm font-medium">Total Documentos</div>
      <div class="text-2xl font-bold text-blue-900">
        {{ getTotalDocuments() }}
      </div>
    </div>
    <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
      <div class="text-yellow-800 text-sm font-medium">Próximos a Vencer</div>
      <div class="text-2xl font-bold text-yellow-900">
        {{ getExpiringCount() }}
      </div>
    </div>
    <div class="bg-red-50 p-4 rounded-lg border border-red-200">
      <div class="text-red-800 text-sm font-medium">Vencidos</div>
      <div class="text-2xl font-bold text-red-900">
        {{ getExpiredCount() }}
      </div>
    </div>
    <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
      <div class="text-purple-800 text-sm font-medium">Sin Verificar</div>
      <div class="text-2xl font-bold text-purple-900">
        {{ getUnverifiedCount() }}
      </div>
    </div>
    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
      <div class="text-gray-800 text-sm font-medium">Espacio Total</div>
      <div class="text-2xl font-bold text-gray-900">
        {{ getTotalSize() }}
      </div>
    </div>
  </div>
</div>
