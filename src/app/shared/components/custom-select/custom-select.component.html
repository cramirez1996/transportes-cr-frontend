<div class="custom-select-container" [class.disabled]="disabled">
  <!-- Selected value / Trigger button -->
  <button
    type="button"
    class="custom-select-trigger"
    [class]="getSizeClasses()"
    [class.open]="isOpen"
    [disabled]="disabled"
    (click)="toggleDropdown()"
  >
    <!-- Selected option (custom template or default) -->
    <div class="selected-content" *ngIf="selectedOption; else placeholderTemplate">
      <!-- Custom selected template -->
      <ng-container *ngIf="selectedTemplate">
        <ng-container
          *ngTemplateOutlet="selectedTemplate; context: { $implicit: selectedOption }"
        ></ng-container>
      </ng-container>

      <!-- Default selected display -->
      <ng-container *ngIf="!selectedTemplate">
        <span class="selected-label">{{ selectedOption.label }}</span>
      </ng-container>
    </div>

    <!-- Placeholder -->
    <ng-template #placeholderTemplate>
      <span class="placeholder">{{ placeholder }}</span>
    </ng-template>

    <!-- Icons -->
    <div class="select-icons">
      <!-- Clear button -->
      <button
        *ngIf="clearable && selectedOption && !disabled"
        type="button"
        class="clear-button"
        (click)="clearSelection($event)"
      >
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          />
        </svg>
      </button>

      <!-- Dropdown arrow -->
      <svg
        class="dropdown-arrow"
        [class.rotate]="isOpen"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M19 9l-7 7-7-7"
        />
      </svg>
    </div>
  </button>

  <!-- Dropdown menu -->
  <div
    #dropdownContainer
    class="custom-select-dropdown"
    [class.open]="isOpen"
    *ngIf="isOpen"
  >
    <!-- Search input -->
    <div class="search-container" *ngIf="searchable">
      <input
        type="text"
        class="search-input"
        placeholder="Buscar..."
        [value]="searchTerm"
        (input)="onSearch($event)"
        (click)="$event.stopPropagation()"
      />
      <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
        />
      </svg>
    </div>

    <!-- Options list -->
    <div class="options-list">
      <!-- No results -->
      <div *ngIf="filteredOptions.length === 0" class="no-results">
        No se encontraron resultados
      </div>

      <!-- Options -->
      <button
        *ngFor="let option of filteredOptions; let i = index"
        type="button"
        class="option-item"
        [class.selected]="selectedOption?.value === option.value"
        [class.focused]="focusedIndex === i"
        [class.disabled]="option.disabled"
        [disabled]="option.disabled"
        (click)="selectOption(option)"
      >
        <!-- Custom option template -->
        <ng-container *ngIf="optionTemplate">
          <ng-container
            *ngTemplateOutlet="optionTemplate; context: { $implicit: option }"
          ></ng-container>
        </ng-container>

        <!-- Default option display -->
        <ng-container *ngIf="!optionTemplate">
          <span class="option-label">{{ option.label }}</span>
        </ng-container>

        <!-- Checkmark for selected option -->
        <svg
          *ngIf="selectedOption?.value === option.value"
          class="checkmark"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M5 13l4 4L19 7"
          />
        </svg>
      </button>
    </div>
  </div>
</div>
